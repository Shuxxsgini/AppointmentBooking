<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Booking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #6366f1;
            --primary-dark: #4338ca;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background-color: #f8fafc;
        }
        
        .calendar-day {
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover:not(.disabled) {
            background-color: #e0e7ff;
            cursor: pointer;
        }
        
        .calendar-day.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .time-slot {
            transition: all 0.2s ease;
        }
        
        .time-slot:hover:not(.booked) {
            background-color: #e0e7ff;
            cursor: pointer;
        }
        
        .time-slot.selected {
            background-color: var(--primary);
            color: white;
        }
        
        .time-slot.booked {
            background-color: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }
        
        @media (max-width: 768px) {
            .booking-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center">
                        <img src="https://placehold.co/40x40?text=Logo&font=roboto" alt="Booking system logo with a calendar icon" class="h-8 w-auto">
                        <span class="ml-2 text-xl font-semibold text-gray-900">AppointMate</span>
                    </div>
                </div>
                <div class="hidden sm:ml-6 sm:flex sm:items-center">
                    <button id="admin-toggle" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Admin Panel
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- User Booking Section -->
        <div id="user-section">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">Book Your Appointment</h1>
                <p class="text-gray-600 max-w-2xl mx-auto">Schedule a meeting with our team. Choose a date and time that works for you.</p>
            </div>

            <!-- Booking Flow -->
            <div class="bg-white rounded-lg shadow-md overflow-hidden">
                <div class="p-6">
                    <!-- Progress Steps -->
                    <div class="flex justify-between mb-8 relative">
                        <div class="flex flex-col items-center w-1/3">
                            <div class="w-10 h-10 rounded-full bg-indigo-600 flex items-center justify-center text-white font-bold mb-1">1</div>
                            <span class="text-xs text-gray-600">Select Date</span>
                        </div>
                        <div class="h-1 bg-gray-200 absolute top-5 left-1/4 right-1/4"></div>
                        <div class="flex flex-col items-center w-1/3">
                            <div class="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold mb-1">2</div>
                            <span class="text-xs text-gray-600">Select Time</span>
                        </div>
                        <div class="h-1 bg-gray-200 absolute top-5 left-2/4 right-1/4"></div>
                        <div class="flex flex-col items-center w-1/3">
                            <div class="w-10 h-10 rounded-full border-2 border-gray-300 flex items-center justify-center font-bold mb-1">3</div>
                            <span class="text-xs text-gray-600">Your Details</span>
                        </div>
                    </div>

                    <!-- Calendar Section -->
                    <div id="calendar-section" class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-semibold text-gray-800">Select a Date</h2>
                            <div class="flex space-x-2">
                                <button id="prev-month" class="p-2 rounded-md hover:bg-gray-100">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button id="next-month" class="p-2 rounded-md hover:bg-gray-100">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div id="calendar" class="grid grid-cols-7 gap-2 mb-4">
                            <!-- Calendar will be generated by JavaScript -->
                        </div>
                        <div class="text-sm text-gray-500">
                            <span class="inline-block w-3 h-3 rounded-full bg-indigo-500 mr-1"></span>
                            <span>Selected date</span>
                            <span class="inline-block w-3 h-3 rounded-full bg-gray-200 ml-4 mr-1"></span>
                            <span>Available</span>
                            <span class="inline-block w-3 h-3 rounded-full bg-gray-400 ml-4 mr-1"></span>
                            <span>Booked</span>
                        </div>
                    </div>

                    <!-- Time Slots Section (hidden initially) -->
                    <div id="time-section" class="mb-8 hidden">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Available Time Slots</h2>
                        <p class="text-gray-600 mb-4" id="selected-date-text">Selected date: </p>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3" id="time-slots-container">
                            <!-- Time slots will be generated by JavaScript -->
                        </div>
                    </div>

                    <!-- Booking Form Section (hidden initially) -->
                    <div id="form-section" class="hidden">
                        <h2 class="text-xl font-semibold text-gray-800 mb-4">Your Information</h2>
                        <form id="booking-form">
                            <div class="grid grid-cols-1 gap-6">
                                <div>
                                    <label for="full-name" class="block text-sm font-medium text-gray-700">Full Name</label>
                                    <input type="text" id="full-name" name="full-name" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 px-3 border">
                                </div>
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
                                    <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 px-3 border">
                                </div>
                                <div>
                                    <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number</label>
                                    <input type="tel" id="phone" name="phone" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 px-3 border">
                                </div>
                                <div>
                                    <label for="location" class="block text-sm font-medium text-gray-700">Location (City/Area)</label>
                                    <input type="text" id="location" name="location" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 px-3 border">
                                </div>
                                <div>
                                    <label for="notes" class="block text-sm font-medium text-gray-700">Additional Notes (Optional)</label>
                                    <textarea id="notes" name="notes" rows="3" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 px-3 border"></textarea>
                                </div>
                            </div>
                            <div class="mt-8 flex justify-end space-x-4">
                                <button type="button" id="back-to-time" class="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Back
                                </button>
                                <button type="submit" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Confirm Booking
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Confirmation Section (hidden initially) -->
                    <div id="confirmation-section" class="hidden">
                        <div class="text-center">
                            <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
                                <i class="fas fa-check text-green-600 text-xl"></i>
                            </div>
                            <h2 class="mt-3 text-xl font-semibold text-gray-900">Booking Confirmed!</h2>
                            <div class="mt-4 max-w-md mx-auto text-gray-600">
                                <p id="confirmation-details" class="text-left bg-gray-50 p-4 rounded-md"></p>
                                <p class="mt-4">A confirmation email with your appointment details and meeting link has been sent to your email address.</p>
                            </div>
                            <div class="mt-6">
                                <button id="new-booking" class="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                    Book Another Appointment
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Panel (hidden initially) -->
        <div id="admin-section" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-gray-900">Admin Dashboard</h1>
                <button id="user-toggle" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                    Back to Booking
                </button>
            </div>

            <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                    <h3 class="text-lg leading-6 font-medium text-gray-900">Scheduled Appointments</h3>
                </div>
                <div class="px-4 py-5 sm:p-6">
                    <div class="flex flex-col">
                        <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                            <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                                <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Date & Time
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Name
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Contact
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Location
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Status
                                                </th>
                                                <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                                                    Actions
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody id="appointments-list" class="bg-white divide-y divide-gray-200">
                                            <!-- Appointments will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- "Backend" Database Simulation -->
    <script>
        // Mock database for demonstration purposes
        const mockDatabase = {
            // Store appointments with date as key
            appointments: {
                // Example appointments
                '2023-11-15': {
                    '09:00': {
                        id: '1',
                        fullName: 'John Doe',
                        email: 'john@example.com',
                        phone: '555-123-4567',
                        location: 'New York',
                        notes: '',
                        status: 'confirmed',
                        meetingLink: 'https://meet.google.com/abc-xyz-123'
                    },
                    '14:00': {
                        id: '2',
                        fullName: 'Jane Smith',
                        email: 'jane@example.com',
                        phone: '555-987-6543',
                        location: 'Los Angeles',
                        notes: 'Looking forward to the meeting!',
                        status: 'pending',
                        meetingLink: 'https://meet.google.com/def-uvw-456'
                    }
                },
                '2023-12-05': {
                    '10:30': {
                        id: '3',
                        fullName: 'Bob Johnson',
                        email: 'bob@example.com',
                        phone: '555-456-7890',
                        location: 'Chicago',
                        notes: 'Test appointment',
                        status: 'confirmed',
                        meetingLink: 'https://meet.google.com/ghi-rst-789'
                    }
                }
            },
            
            // Get all appointments
            getAllAppointments: function() {
                const allAppointments = [];
                for (const date in this.appointments) {
                    for (const time in this.appointments[date]) {
                        const appointment = this.appointments[date][time];
                        appointment.date = date;
                        appointment.time = time;
                        allAppointments.push(appointment);
                    }
                }
                return allAppointments;
            },
            
            // Add new appointment
            addAppointment: function(date, time, appointmentData) {
                if (!this.appointments[date]) {
                    this.appointments[date] = {};
                }
                
                // Generate a unique ID
                const id = Math.random().toString(36).substring(2, 9);
                const meetingLink = `https://meet.google.com/${Math.random().toString(36).substring(2, 15)}`;
                
                const newAppointment = {
                    id: id,
                    ...appointmentData,
                    status: 'confirmed', // Auto-confirm in this demo
                    meetingLink: meetingLink
                };
                
                this.appointments[date][time] = newAppointment;
                
                // Simulate email sending
                this.sendConfirmationEmail(newAppointment, date, time);
                
                return newAppointment;
            },
            
            // Update appointment status
            updateAppointmentStatus: function(id, newStatus) {
                for (const date in this.appointments) {
                    for (const time in this.appointments[date]) {
                        if (this.appointments[date][time].id === id) {
                            this.appointments[date][time].status = newStatus;
                            return true;
                        }
                    }
                }
                return false;
            },
            
            // Delete appointment
            deleteAppointment: function(id) {
                for (const date in this.appointments) {
                    for (const time in this.appointments[date]) {
                        if (this.appointments[date][time].id === id) {
                            delete this.appointments[date][time];
                            // If no more appointments for this date, remove the date
                            if (Object.keys(this.appointments[date]).length === 0) {
                                delete this.appointments[date];
                            }
                            return true;
                        }
                    }
                }
                return false;
            },
            
            // Simulate sending confirmation email
            sendConfirmationEmail: function(appointment, date, time) {
                console.log('Simulating email sending to:', appointment.email);
                console.log('Subject: Your appointment confirmation');
                console.log(`Body:
Hello ${appointment.fullName},

Your appointment has been confirmed for:
Date: ${new Date(date).toDateString()}
Time: ${time}

Location: ${appointment.location}

Google Meet Link: ${appointment.meetingLink}

Thank you for booking with us!
`);
            }
        };

        // Initialize the booking system when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // UI State
            let currentState = {
                selectedDate: null,
                selectedTime: null,
                currentMonth: new Date().getMonth(),
                currentYear: new Date().getFullYear()
            };

            // UI Elements
            const calendarSection = document.getElementById('calendar-section');
            const timeSection = document.getElementById('time-section');
            const formSection = document.getElementById('form-section');
            const confirmationSection = document.getElementById('confirmation-section');
            const userSection = document.getElementById('user-section');
            const adminSection = document.getElementById('admin-section');
            
            const calendarElement = document.getElementById('calendar');
            const timeSlotsContainer = document.getElementById('time-slots-container');
            const selectedDateText = document.getElementById('selected-date-text');
            const bookingForm = document.getElementById('booking-form');
            const confirmationDetails = document.getElementById('confirmation-details');
            
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const backToTimeBtn = document.getElementById('back-to-time');
            const newBookingBtn = document.getElementById('new-booking');
            const adminToggleBtn = document.getElementById('admin-toggle');
            const userToggleBtn = document.getElementById('user-toggle');
            const appointmentsList = document.getElementById('appointments-list');

            // Initialize the app
            generateCalendar();
            loadAdminAppointments();

            // Event listeners
            prevMonthBtn.addEventListener('click', () => {
                if (currentState.currentMonth === 0) {
                    currentState.currentMonth = 11;
                    currentState.currentYear--;
                } else {
                    currentState.currentMonth--;
                }
                generateCalendar();
            });

            nextMonthBtn.addEventListener('click', () => {
                if (currentState.currentMonth === 11) {
                    currentState.currentMonth = 0;
                    currentState.currentYear++;
                } else {
                    currentState.currentMonth++;
                }
                generateCalendar();
            });

            backToTimeBtn.addEventListener('click', () => {
                timeSection.classList.remove('hidden');
                formSection.classList.add('hidden');
                // Update progress steps
                updateProgressSteps(2);
            });

            newBookingBtn.addEventListener('click', () => {
                // Reset the booking flow
                currentState.selectedDate = null;
                currentState.selectedTime = null;
                
                confirmationSection.classList.add('hidden');
                calendarSection.classList.remove('hidden');
                
                // Update progress steps
                updateProgressSteps(1);
                
                // Regenerate calendar to clear selections
                generateCalendar();
            });

            adminToggleBtn.addEventListener('click', () => {
                userSection.classList.add('hidden');
                adminSection.classList.remove('hidden');
                loadAdminAppointments();
            });

            userToggleBtn.addEventListener('click', () => {
                adminSection.classList.add('hidden');
                userSection.classList.remove('hidden');
    
